
&НаКлиенте
Процедура ХозяйствующийСубъектНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	ВетисФормы.BusinessEntityФормаВыбора(ЭтаФорма, "ОтборХозяйствующийСубъектНачалоВыбораОбработкаОповещения", СтандартнаяОбработка, Объект.ХозяйствующийСубъект);
	
КонецПроцедуры

&НаКлиенте
Процедура ОтборХозяйствующийСубъектНачалоВыбораОбработкаОповещения(пРезультат, пПараметры) Экспорт
	
	Если НЕ пРезультат = Неопределено Тогда
		Объект.ХозяйствующийСубъект = пРезультат;
		Объект.Предприятие = Неопределено;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ХозяйствующийСубъектПриИзменении(Элемент)
	
	Объект.Предприятие = Неопределено;
	
КонецПроцедуры

&НаКлиенте
Процедура ПредприятиеНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	ВетисФормы.EnterpriseФормаВыбора(ЭтаФорма, "ПредприятиеОбработкаОповещения", СтандартнаяОбработка, Объект.Предприятие, Объект.ХозяйствующийСубъект);
	
КонецПроцедуры

&НаКлиенте
Процедура ПредприятиеОбработкаОповещения(пРезультат, пПараметры) Экспорт
	
	Если НЕ пРезультат = Неопределено Тогда
		Объект.Предприятие = пРезультат;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ОтчетВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	ПоказатьВводСтроки(, Элементы.Отчет.ТекущиеДанные.Результат,,,Истина);
	
КонецПроцедуры


&НаКлиенте
Процедура КомандаЗапуск(Команда)
	КомандаЗапускНаСервере();
КонецПроцедуры

&НаСервере
Процедура КомандаЗапускНаСервере()
	
	Перем _Item, _параметры, _ДатаНачала;
	
	_Версия20 = Ветис.Версия_2_0();
	
	Отчет.Очистить();
	
	Если _Версия20 Тогда
		
		_businessEntityGuid = ВетисDictionaryСлой1с.BusinessEntity(Объект.ХозяйствующийСубъект);
		_enterpriseGuid     = ВетисDictionaryСлой1с.Enterprise(Объект.Предприятие);
		
		_businessEntity = ВетисDictionary_2_0.BusinessEntity(ВетисDictionaryСлой1с.BusinessEntity(Объект.ХозяйствующийСубъект));
		_enterprise     = ВетисDictionary_2_0.Enterprise(ВетисDictionaryСлой1с.Enterprise(Объект.Предприятие));
		
		////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		_Отказ = Ложь;
		_Ошибка = "";
		_Item = Неопределено;
		_параметры = Неопределено;
		_ДатаНачала = Дата(1,1,1);
		
		Попытка
			Пока ВетисMercuryApplications_2_0.GetStockEntryChangesListСледующий(_enterpriseGuid, _ДатаНачала, , _businessEntityGuid, _Item, _параметры, _Отказ, _Ошибка) Цикл
				Если _Отказ = Истина Тогда
					Прервать; 
				КонецЕсли;
			КонецЦикла;
			
			ОтчетДополнить("GetStockEntryChangesList", ?(_Отказ, _Ошибка, "Ок"));
		Исключение
			ОтчетДополнить("GetStockEntryChangesList", ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		КонецПопытки;
		
		////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		_Отказ = Ложь;
		_Ошибка = "";
		_Item = Неопределено;
		_параметры = Неопределено;
		
		Попытка
			Пока ВетисMercuryApplications_2_0.GetStockEntryListСледующий(_enterpriseGuid, _businessEntityGuid, _Item, _параметры, _Отказ, _Ошибка) Цикл
				Если _Отказ = Истина Тогда
					Прервать; 
				КонецЕсли;
			КонецЦикла;
			
			ОтчетДополнить("GetStockEntryList", ?(_Отказ, _Ошибка, "Ок"));
		Исключение
			ОтчетДополнить("GetStockEntryList", ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		КонецПопытки;
		
		////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		_Отказ = Ложь;
		_Ошибка = "";
		_Item = Неопределено;
		_параметры = Неопределено;
		_ДатаНачала = Дата(1,1,1);
		
		Попытка
			Пока ВетисMercuryApplications_2_0.GetVetDocumentChangesListСледующий(_enterpriseGuid, _businessEntityGuid, _ДатаНачала, , _Item, _параметры, _Отказ, _Ошибка) Цикл
				Если _Отказ = Истина Тогда
					Прервать; 
				КонецЕсли;
			КонецЦикла;
			
			ОтчетДополнить("GetVetDocumentChangesList", ?(_Отказ, _Ошибка, "Ок"));
		Исключение
			ОтчетДополнить("GetVetDocumentChangesList", ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		КонецПопытки;
		
		////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		_Отказ = Ложь;
		_Ошибка = "";
		_Item = Неопределено;
		_параметры = Неопределено;
		
		Попытка
			Пока ВетисMercuryApplications_2_0.GetVetDocumentListСледующий(_enterpriseGuid, _businessEntityGuid, , ВетисКонстанты.VetDocumentStatus_CONFIRMED(), _Item, _параметры, _Отказ, _Ошибка) Цикл
				Если _Отказ = Истина Тогда
					Прервать;
				КонецЕсли;
				Если НЕ _Item.certifiedConsignment.batch.packageList = Неопределено Тогда
					Для каждого _package Из _Item.certifiedConsignment.batch.packageList.package Цикл
						_тест = _package.Свойства().Получить("name");
						_тест = _package.Свойства().Получить("uuid");
						_тест = _package.Свойства().Получить("guid");
						_тест = _package.Свойства().Получить("globalID");
					КонецЦикла;
				КонецЕсли;
			КонецЦикла;
			
			ОтчетДополнить("GetVetDocumentList", ?(_Отказ, _Ошибка, "Ок"));
		Исключение
			ОтчетДополнить("GetVetDocumentList", ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		КонецПопытки;
		
		////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		
	Иначе
		
		_businessEntityGuid = ВетисCerberusEnterpriseСлой1с.BusinessEntity(Объект.ХозяйствующийСубъект);
		_enterpriseGuid     = ВетисCerberusEnterpriseСлой1с.Enterprise(Объект.Предприятие);
		
		_businessEntity = ВетисCerberusEnterprise.BusinessEntity(ВетисDictionaryСлой1с.BusinessEntity(Объект.ХозяйствующийСубъект));
		_enterprise     = ВетисCerberusEnterprise.Enterprise(ВетисDictionaryСлой1с.Enterprise(Объект.Предприятие));
		
		
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ОтчетДополнить(пЭтап, пРезультат)
	
	_ОтчетСтрока = Отчет.Добавить();
	_ОтчетСтрока.Этап = пЭтап;
	_ОтчетСтрока.Результат = пРезультат;
	
КонецПроцедуры
